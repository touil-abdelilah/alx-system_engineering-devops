#!/usr/bin/env bash

# Install nginx
sudo apt-get update
sudo apt-get install nginx -y


# Check nginx status
nginx_status=$(pgrep nginx)
if [ -z "$nginx_status" ]; then
    echo "Error: Nginx is not running."
    exit 1
fi

# Configure nginx to listen on port 80
sudo sed -i 's/listen 80 default_server;/listen 80;/g' /etc/nginx/sites-available/default

# Restart nginx
sudo service nginx restart

# Check if nginx restarted successfully
nginx_status=$(pgrep nginx)
if [ -z "$nginx_status" ]; then
    echo "Error: Nginx failed to restart."
    exit 1
fi

# Test if nginx is listening on port 80 and returning "Hello World!"
curl_output=$(curl -s http://localhost/)
if [[ $curl_output == *"Hello World!"* ]]; then
    echo "Nginx is listening on port 80 and returning 'Hello World!'"
else
    echo "Error: Nginx is not returning 'Hello World!'"
    exit 1
fi

# Script completed successfully
echo "Nginx configured successfully."
exit 0
